{"version":3,"file":"dialogue.min.js","sources":["../src/modal.js","../src/common.js","../src/options.js","../src/dialogue.js"],"sourcesContent":["// amd/src/modal.js\n\n/**\n * Abstract Recording Modal for TinyMCE's RecordRTC plugin.\n *\n * @module      tiny_pumukitmedia/modal\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Modal from 'core/modal';\n\nexport default class PumukitModal extends Modal {\n    static TYPE = 'tiny_pumukitmedia/modal';\n    static TEMPLATE = 'tiny_pumukitmedia/modal';\n\n    registerEventListeners() {\n        this.setRemoveOnClose(true);\n        super.registerEventListeners();\n        this.registerCloseOnCancel();\n    }\n}\n\nPumukitModal.registerModalType();\n","// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny Pumukitmedia common values.\n *\n * @module      tiny_pumukitmedia/common\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nexport const pluginName = 'tiny_pumukitmedia/plugin';\nexport const component = 'tiny_pumukitmedia';\nexport const pluginButtonName = 'pumukitmedia';\n","/**\n * Options helper for the Moodle Tiny Pumukitmedia plugin.\n *\n * @module      tiny_pumukitmedia/options\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {pluginName} from './common';\nimport {getPluginOptionName} from 'editor_tiny/options';\n\nconst urlOption = getPluginOptionName(pluginName, 'pumukitmediaurl');\nconst titleOption = getPluginOptionName(pluginName, 'dialogtitle');\nconst usernameOption = getPluginOptionName(pluginName, 'username');\nconst emailOption = getPluginOptionName(pluginName, 'email');\nconst hashOption = getPluginOptionName(pluginName, 'hash');\nconst showPrOption = getPluginOptionName(pluginName, 'showpr');\nconst showPlaylistOption = getPluginOptionName(pluginName, 'showplaylist');\nconst showSharedOption = getPluginOptionName(pluginName, 'showsharedvideos');\n\nexport const register = (editor) => {\n    editor.options.register(urlOption, {\n        processor: 'string',\n        default: '',\n    });\n    editor.options.register(titleOption, {\n        processor: 'string',\n        default: '',\n    });\n    editor.options.register(usernameOption, {\n        processor: 'string',\n        default: '',\n    });\n    editor.options.register(emailOption, {\n        processor: 'string',\n        default: '',\n    });\n    editor.options.register(hashOption, {\n        processor: 'string',\n        default: '',\n    });\n    editor.options.register(showPrOption, {\n        processor: 'boolean',\n        default: true,\n    });\n    editor.options.register(showPlaylistOption, {\n        processor: 'boolean',\n        default: false,\n    });\n    editor.options.register(showSharedOption, {\n        processor: 'boolean',\n        default: true,\n    });\n};\n\n// Funciones de ayuda\nexport const getPumukitUrl = (editor) => {\n    const value = editor.options.get(urlOption);\n    return typeof value === 'string' ? value.trim() : '';\n};\nexport const getDialogTitle = (editor) => editor.options.get(titleOption);\nexport const getUsername = (editor) => editor.options.get(usernameOption);\nexport const getEmail = (editor) => editor.options.get(emailOption);\nexport const getHash = (editor) => editor.options.get(hashOption);\nexport const getShowPr = (editor) => editor.options.get(showPrOption);\nexport const getShowPlaylist = (editor) => editor.options.get(showPlaylistOption);\nexport const getShowSharedVideos = (editor) => editor.options.get(showSharedOption);\n","// @module tiny_pumukitmedia/dialogue\n\nimport PumukitModal from './modal';\nimport {\n    getDialogTitle,\n    getPumukitUrl,\n    getHash,\n    getUsername,\n    getEmail,\n    getShowPr,\n    getShowPlaylist,\n    getShowSharedVideos\n} from './options';\n\nexport const openPumukitDialogue = async (editor) => {\n    const modaltitle = getDialogTitle(editor);\n    const pumukitUrl = getPumukitUrl(editor);\n    const hash = getHash(editor);\n    const username = getUsername(editor);\n    const email = getEmail(editor);\n    const lang = document.documentElement.lang || 'en';\n    const showpr = getShowPr(editor);\n    const showplaylist = getShowPlaylist(editor);\n    const showsharedvideos = getShowSharedVideos(editor);\n\n    const context = {\n        modaltitle,\n        pumukitUrl,\n        hash,\n        username,\n        email,\n        lang,\n        showpr,\n        showplaylist,\n        showsharedvideos\n    };\n\n    const iframeId = 'pumukitmedia_iframe_sso';\n    const existingIframe = document.getElementById(iframeId);\n\n    const createModalAndShow = async () => {\n        try {\n            const modal = await PumukitModal.create({\n                templateContext: context,\n                large: true,\n            });\n\n            modal.show();\n            setupModalEvents(modal, editor, pumukitUrl);\n\n        } catch (error) {\n            console.error('Error creando la modal de PuMuKIT:', error);\n        }\n    };\n\n    if (!existingIframe) {\n        const iframe = document.createElement('iframe');\n        iframe.id = iframeId;\n        iframe.style.display = 'none';\n        iframe.src = `${pumukitUrl}/openedx/sso/manager?hash=${hash}&username=${username}&email=${email}&lang=${lang}`;\n        iframe.allow = \"microphone; camera; display-capture; clipboard-write\";\n\n        iframe.onload = createModalAndShow;\n\n        document.body.appendChild(iframe);\n    } else {\n        createModalAndShow();\n    }\n};\n\nfunction setupModalEvents(modal, editor, pumukitUrl) {\n    modal.getRoot().on('click', '.nav-tabs .nav-link', function (e) {\n        e.preventDefault();\n\n        const root = modal.getRoot()[0];\n        const clickedLink = e.target;\n        const targetId = clickedLink.getAttribute('href');\n\n        root.querySelectorAll(\".nav-tabs .nav-link\").forEach(link => {\n            link.classList.remove(\"active\");\n        });\n\n        root.querySelectorAll(\".tab-pane\").forEach(pane => {\n            pane.classList.remove(\"show\", \"active\");\n        });\n\n        clickedLink.classList.add(\"active\");\n        const targetPane = root.querySelector(targetId);\n        if (targetPane) {\n            targetPane.classList.add(\"show\", \"active\");\n        }\n    });\n\n    const receiveMessage = (event) => {\n        const data = event.data;\n        if (!data || (!data.mmId && !data.url && !data.playlist)) return;\n\n        let embedUrl = '';\n        if (data.url) {\n            embedUrl = data.url;\n        } else if (data.playlist) {\n            embedUrl = `${pumukitUrl}/openedx/openedx/playlist/embed/${data.playlist}`;\n        } else if (data.mmId) {\n            embedUrl = `${pumukitUrl}/openedx/openedx/embed/${data.mmId}`;\n        }\n\n        const embedHtml = `<a href=\"${embedUrl}\" target=\"_blank\" class=\"pumukit-media-link\">${embedUrl}</a>`;\n\n        editor.insertContent(embedHtml);\n        modal.hide();\n        window.removeEventListener('message', receiveMessage);\n    };\n\n    window.addEventListener('message', receiveMessage);\n\n    modal.getRoot().on('hidden.bs.modal', () => {\n        window.removeEventListener('message', receiveMessage);\n    });\n}\n"],"names":["PumukitModal","Modal","static","registerEventListeners","this","setRemoveOnClose","super","registerCloseOnCancel","registerModalType","pluginName","urlOption","getPluginOptionName","titleOption","usernameOption","emailOption","hashOption","showPrOption","showPlaylistOption","showSharedOption","async","editor","modaltitle","options","get","getDialogTitle","pumukitUrl","value","trim","getPumukitUrl","hash","getHash","username","getUsername","email","getEmail","lang","document","documentElement","showpr","getShowPr","showplaylist","getShowPlaylist","showsharedvideos","getShowSharedVideos","context","iframeId","createModalAndShow","modal","create","templateContext","large","show","getRoot","on","e","preventDefault","root","clickedLink","target","targetId","getAttribute","querySelectorAll","forEach","link","classList","remove","pane","add","targetPane","querySelector","receiveMessage","event","data","mmId","url","playlist","embedUrl","embedHtml","insertContent","hide","window","removeEventListener","addEventListener","setupModalEvents","error","console","getElementById","iframe","createElement","id","style","display","src","allow","onload","body","appendChild"],"mappings":"oFAWe,MAAMA,UAAqBC,EACtCC,YAAc,0BACdA,gBAAkB,0BAElB,sBAAAC,GACIC,KAAKC,kBAAiB,GACtBC,MAAMH,yBACNC,KAAKG,uBACb,EAGAP,EAAaQ;;;;;;;ACAN,MAAMC,EAAa,2BCZpBC,EAAYC,EAAAA,oBAAoBF,EAAY,mBAC5CG,EAAcD,EAAAA,oBAAoBF,EAAY,eAC9CI,EAAiBF,EAAAA,oBAAoBF,EAAY,YACjDK,EAAcH,EAAAA,oBAAoBF,EAAY,SAC9CM,EAAaJ,EAAAA,oBAAoBF,EAAY,QAC7CO,EAAeL,EAAAA,oBAAoBF,EAAY,UAC/CQ,EAAqBN,EAAAA,oBAAoBF,EAAY,gBACrDS,EAAmBP,EAAAA,oBAAoBF,EAAY;;;;;;6BCHtBU,MAAOC,IACtC,MAAMC,ED4CoB,CAACD,GAAWA,EAAOE,QAAQC,IAAIX,GC5CtCY,CAAeJ,GAC5BK,EDuCmB,CAACL,IAC1B,MAAMM,EAAQN,EAAOE,QAAQC,IAAIb,GACjC,MAAwB,iBAAVgB,EAAqBA,EAAMC,OAAS,ICzC/BC,CAAcR,GAC3BS,ED6Ca,CAACT,GAAWA,EAAOE,QAAQC,IAAIR,GC7CrCe,CAAQV,GACfW,ED0CiB,CAACX,GAAWA,EAAOE,QAAQC,IAAIV,GC1CrCmB,CAAYZ,GACvBa,ED0Cc,CAACb,GAAWA,EAAOE,QAAQC,IAAIT,GC1CrCoB,CAASd,GACjBe,EAAOC,SAASC,gBAAgBF,MAAQ,KACxCG,ED0Ce,CAAClB,GAAWA,EAAOE,QAAQC,IAAIP,GC1CrCuB,CAAUnB,GACnBoB,ED0CqB,CAACpB,GAAWA,EAAOE,QAAQC,IAAIN,GC1CrCwB,CAAgBrB,GAC/BsB,ED0CyB,CAACtB,GAAWA,EAAOE,QAAQC,IAAIL,GC1CrCyB,CAAoBvB,GAEvCwB,EAAU,CACZvB,aACAI,aACAI,OACAE,WACAE,QACAE,OACAG,SACAE,eACAE,oBAGEG,EAAW,0BAGXC,EAAqB3B,UACvB,IACI,MAAM4B,QAAc/C,EAAagD,OAAO,CACpCC,gBAAiBL,EACjBM,OAAO,IAGXH,EAAMI,OAuBlB,SAA0BJ,EAAO3B,EAAQK,GACrCsB,EAAMK,UAAUC,GAAG,QAAS,uBAAuB,SAAUC,GACzDA,EAAEC,iBAEF,MAAMC,EAAOT,EAAMK,UAAU,GACvBK,EAAcH,EAAEI,OAChBC,EAAWF,EAAYG,aAAa,QAE1CJ,EAAKK,iBAAiB,uBAAuBC,SAAQC,IACjDA,EAAKC,UAAUC,OAAO,aAG1BT,EAAKK,iBAAiB,aAAaC,SAAQI,IACvCA,EAAKF,UAAUC,OAAO,OAAQ,aAGlCR,EAAYO,UAAUG,IAAI,UAC1B,MAAMC,EAAaZ,EAAKa,cAAcV,GAClCS,GACAA,EAAWJ,UAAUG,IAAI,OAAQ,SAE7C,IAEI,MAAMG,EAAkBC,IACpB,MAAMC,EAAOD,EAAMC,KACnB,IAAKA,IAAUA,EAAKC,OAASD,EAAKE,MAAQF,EAAKG,SAAW,OAE1D,IAAIC,EAAW,GACXJ,EAAKE,IACLE,EAAWJ,EAAKE,IACTF,EAAKG,SACZC,EAAW,GAAGnD,oCAA6C+C,EAAKG,WACzDH,EAAKC,OACZG,EAAW,GAAGnD,2BAAoC+C,EAAKC,QAG3D,MAAMI,EAAY,YAAYD,iDAAwDA,QAEtFxD,EAAO0D,cAAcD,GACrB9B,EAAMgC,OACNC,OAAOC,oBAAoB,UAAWX,IAG1CU,OAAOE,iBAAiB,UAAWZ,GAEnCvB,EAAMK,UAAUC,GAAG,mBAAmB,KAClC2B,OAAOC,oBAAoB,UAAWX,KAE9C,CAtEYa,CAAiBpC,EAAO3B,EAAQK,EAEnC,CAAC,MAAO2D,GACLC,QAAQD,MAAM,qCAAsCA,EAChE,GAGI,GAjBuBhD,SAASkD,eAAezC,GA4B3CC,QAXiB,CACjB,MAAMyC,EAASnD,SAASoD,cAAc,UACtCD,EAAOE,GAAK5C,EACZ0C,EAAOG,MAAMC,QAAU,OACvBJ,EAAOK,IAAM,GAAGnE,8BAAuCI,cAAiBE,WAAkBE,UAAcE,IACxGoD,EAAOM,MAAQ,uDAEfN,EAAOO,OAAShD,EAEhBV,SAAS2D,KAAKC,YAAYT,EAClC"}