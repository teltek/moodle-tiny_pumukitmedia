{"version":3,"file":"dialogue.min.js","sources":["../src/common.js","../src/options.js","../src/dialogue.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny Pumukitmedia common values.\n *\n * @module      tiny_pumukitmedia/common\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nexport const pluginName = 'tiny_pumukitmedia/plugin';\nexport const component = 'tiny_pumukitmedia';\nexport const pluginButtonName = 'pumukitmedia';\n","/**\n * Options helper for the Moodle Tiny Pumukitmedia plugin.\n *\n * @module      tiny_pumukitmedia/options\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {pluginName} from './common';\nimport {getPluginOptionName} from 'editor_tiny/options';\n\nconst urlOption = getPluginOptionName(pluginName, 'pumukitmediaurl');\nconst titleOption = getPluginOptionName(pluginName, 'dialogtitle');\nconst usernameOption = getPluginOptionName(pluginName, 'username');\nconst emailOption = getPluginOptionName(pluginName, 'email');\nconst hashOption = getPluginOptionName(pluginName, 'hash');\n\nexport const register = (editor) => {\n    editor.options.register(urlOption, {\n        processor: 'string',\n        default: '',\n    });\n    editor.options.register(titleOption, {\n        processor: 'string',\n        default: '',\n    });\n    editor.options.register(usernameOption, {\n        processor: 'string',\n        default: '',\n    });\n    editor.options.register(emailOption, {\n        processor: 'string',\n        default: '',\n    });\n    editor.options.register(hashOption, {\n        processor: 'string',\n        default: '',\n    });\n};\n\n// Funciones de ayuda\nexport const getPumukitUrl = (editor) => editor.options.get(urlOption);\nexport const getDialogTitle = (editor) => editor.options.get(titleOption);\nexport const getUsername = (editor) => editor.options.get(usernameOption);\nexport const getEmail = (editor) => editor.options.get(emailOption);\nexport const getHash = (editor) => editor.options.get(hashOption);\n","// @module tiny_pumukitmedia/dialogue\n\nimport {\n    getPumukitUrl,\n    getHash,\n    getUsername,\n    getEmail,\n} from './options';\n\nexport const openPumukitDialogue = (editor) => {\n    const pumukitUrl = getPumukitUrl(editor);\n    const hash = getHash(editor);\n    const username = getUsername(editor);\n    const email = getEmail(editor);\n    const lang = document.documentElement.lang || 'en';\n\n    const html = `\n        <ul class=\"nav nav-tabs\" role=\"tablist\" style=\"margin-bottom:10px;\">\n            <li class=\"active\"><a href=\"#manager\" data-toggle=\"tab\">Mis vídeos</a></li>\n            <li><a href=\"#recorder\" data-toggle=\"tab\">Grabador</a></li>\n            <li><a href=\"#playlist\" data-toggle=\"tab\">Playlist</a></li>\n            <li><a href=\"#shared\" data-toggle=\"tab\">Compartidos</a></li>\n        </ul>\n        <div class=\"tab-content\">\n            <div class=\"tab-pane active\" id=\"manager\">\n                <iframe src=\"${pumukitUrl}/openedx/sso/manager?hash=${hash}&username=${username}&email=${email}&lang=${lang}\"\n                        width=\"100%\" height=\"500\" frameborder=\"0\" allowfullscreen allow=\"microphone; camera; display-capture\"></iframe>\n            </div>\n            <div class=\"tab-pane\" id=\"recorder\">\n                <iframe src=\"${pumukitUrl}/openedx/sso/personal_recorder?hash=${hash}&username=${username}&email=${email}&lang=${lang}\"\n                        width=\"100%\" height=\"500\" frameborder=\"0\" allowfullscreen allow=\"microphone; camera; display-capture\"></iframe>\n            </div>\n            <div class=\"tab-pane\" id=\"playlist\">\n                <iframe src=\"${pumukitUrl}/openedx/sso/manager?hash=${hash}&username=${username}&email=${email}&lang=${lang}&playlist=true\"\n                        width=\"100%\" height=\"500\" frameborder=\"0\" allowfullscreen allow=\"microphone; camera; display-capture\"></iframe>\n            </div>\n            <div class=\"tab-pane\" id=\"shared\">\n                <iframe src=\"${pumukitUrl}/openedx/search/public/multimediaobjects\"\n                        width=\"100%\" height=\"500\" frameborder=\"0\" allowfullscreen allow=\"microphone; camera; display-capture\"></iframe>\n            </div>\n        </div>\n    `;\n\n    const dialogApi = editor.windowManager.open({\n        title: 'Insertar vídeo PuMuKIT',\n        body: {\n            type: 'panel',\n            items: [{ type: 'htmlpanel', html }]\n        },\n        buttons: [\n            { type: 'cancel', text: 'Cerrar' }\n        ],\n        width: 900,\n        height: 600,\n        onClose: () => {\n            window.removeEventListener('message', receiveMessage);\n        }\n    });\n\n    function receiveMessage(event) {\n        const data = event.data;\n        if (!data || (!data.mmId && !data.url && !data.playlist)) return;\n\n        let embedUrl = '';\n        if (data.url) {\n            embedUrl = data.url;\n        } else if (data.playlist) {\n            embedUrl = `${pumukitUrl}/openedx/openedx/playlist/embed/${data.playlist}`;\n        } else if (data.mmId) {\n            embedUrl = `${pumukitUrl}/openedx/openedx/embed/${data.mmId}`;\n        }\n\n        const embedHtml = `\n            <div class=\"embed-responsive embed-responsive-16by9\">\n                <iframe \n                    class=\"embed-responsive-item\" \n                    src=\"${embedUrl}\" \n                    width=\"100%\" \n                    height=\"400\" \n                    frameborder=\"0\" \n                    allowfullscreen \n                    allow=\"microphone; camera; display-capture\">\n                </iframe>\n            </div>\n        `;\n\n        editor.insertContent(embedHtml);\n        dialogApi.close();\n        window.removeEventListener('message', receiveMessage);\n    }\n\n    window.addEventListener('message', receiveMessage);\n}\n"],"names":["pluginName","urlOption","getPluginOptionName","options","usernameOption","emailOption","hashOption","editor","pumukitUrl","get","getPumukitUrl","hash","getHash","username","getUsername","email","getEmail","lang","document","documentElement","html","dialogApi","windowManager","open","title","body","type","items","buttons","text","width","height","onClose","window","removeEventListener","receiveMessage","event","data","mmId","url","playlist","embedUrl","embedHtml","insertContent","close","addEventListener"],"mappings":";;;;;;OAsBO,MAAMA,EAAa,2BCZpBC,EAAYC,EAAAA,oBAAoBF,EAAY;;;;;;OACXG,EAAAD,oBAACF,EAAY,eACpD,MAAMI,EAAiBF,EAAAA,oBAAoBF,EAAY,YACjDK,EAAcH,EAAAA,oBAAoBF,EAAY,SAC9CM,EAAaJ,EAAAA,oBAAoBF,EAAY,8BCLfO,IAChC,MAAMC,ED8BmB,CAACD,GAAWA,EAAOJ,QAAQM,IAAIR,GC9BrCS,CAAcH,GAC3BI,EDiCa,CAACJ,GAAWA,EAAOJ,QAAQM,IAAIH,GCjCrCM,CAAQL,GACfM,ED8BiB,CAACN,GAAWA,EAAOJ,QAAQM,IAAIL,GC9BrCU,CAAYP,GACvBQ,ED8Bc,CAACR,GAAWA,EAAOJ,QAAQM,IAAIJ,GC9BrCW,CAAST,GACjBU,EAAOC,SAASC,gBAAgBF,MAAQ,KAExCG,EAAO,+gBAScZ,8BAAuCG,cAAiBE,WAAkBE,UAAcE,mPAIxFT,wCAAiDG,cAAiBE,WAAkBE,UAAcE,mPAIlGT,8BAAuCG,cAAiBE,WAAkBE,UAAcE,+PAIxFT,gOAMrBa,EAAYd,EAAOe,cAAcC,KAAK,CACxCC,MAAO,yBACPC,KAAM,CACFC,KAAM,QACNC,MAAO,CAAC,CAAED,KAAM,YAAaN,UAEjCQ,QAAS,CACL,CAAEF,KAAM,SAAUG,KAAM,WAE5BC,MAAO,IACPC,OAAQ,IACRC,QAAS,KACLC,OAAOC,oBAAoB,UAAWC,MAI9C,SAASA,EAAeC,GACpB,MAAMC,EAAOD,EAAMC,KACnB,IAAKA,IAAUA,EAAKC,OAASD,EAAKE,MAAQF,EAAKG,SAAW,OAE1D,IAAIC,EAAW,GACXJ,EAAKE,IACLE,EAAWJ,EAAKE,IACTF,EAAKG,SACZC,EAAW,GAAGjC,oCAA6C6B,EAAKG,WACzDH,EAAKC,OACZG,EAAW,GAAGjC,2BAAoC6B,EAAKC,QAG3D,MAAMI,EAAY,+KAICD,mRAUnBlC,EAAOoC,cAAcD,GACrBrB,EAAUuB,QACVX,OAAOC,oBAAoB,UAAWC,EAC9C,CAEIF,OAAOY,iBAAiB,UAAWV"}